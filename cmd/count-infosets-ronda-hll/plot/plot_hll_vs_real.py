import matplotlib.pyplot as plt

title = "HLL estimate for mini-Truco with -deck=7 -info=InfosetRondaBase -hash=sha160 -abs=null"
real = 4_690
hll_evol = [4121,4417,4530,4570,4597,4618,4630,4640,4648,4654,4659,4664,4665,4670,4670,4671,4674,4674,4678,4679,4679,4679,4679,4682,4682,4683,4683,4683,4685,4685,4685,4685,4685,4685,4685,4686,4686,4686,4686,4686,4687,4687,4687,4687,4687,4687,4687,4687,4688,4688,4688,4689,4689,4689,4689,4689,4689,4689,4689,]

fig, ax = plt.subplots(1,1, figsize=(10,5))

ax.plot(list(range(len(hll_evol))), hll_evol, '-', linewidth=0.8, label='hll 1min')

ax.axhline(y=(real), color='r', linestyle='--', linewidth=0.5, alpha=0.5, label=f"real {real}")

ax.set_xlabel('time (s)')
ax.set_ylabel('Estimated cardinality')
ax.set_title(title)
ax.legend()

plt.tight_layout()
plt.show()

# -----------------------

title = "HLL estimate for mini-Truco with -deck=14 -info=InfosetRondaBase -hash=sha160 -abs=null"
real = 248_732
# hll_evol = [31222,49891,64732,76876,86973,95887,103937,110734,116917,122465,127682,132192,136424,140010,143454,146829,149858,152604,155314,157800,160058,162287,164562,166657,168614,170267,171965,173557,175139,176582,177993,179314,180803,182146,183335,184612,185728,186802,187855,188757,189750,190720,191562,192386,193324,194184,194946,195762,196424,197167,197894,198590,199321,199898,200509,201210,201848,202475,203111,203677,204203,204842,205319,205943,206471,207022,207431,207937,208494,208969,209412,209816,210183,210602,210937,211435,211759,212111,212486,212850,213212,213504,213814,214226,214507,214932,215280,215604,215838,216217,216477,216829,217121,217362,217531,217899,218098,218350,218653,218925,219144,219399,219653,219871,220114,220317,220635,220876,221050,221221,221385,221646,221923,222169,222392,222607,222810,222961,223156,223381,223569,223756,223922,224051,224303,224455,224600,224781,224922,225030,225207,225383,225562,225711,225875,225969,226126,226269,226379,226612,226757,226882,227012,227105,227274,227372,227538,227627,227745,227865,228001,228083,228174,228282,228410,228504,228645,228786,228906,229053,229207,229320,229415,229535,229658,229787,229909,230002,230098,230215,230294,230374,230439,230584,230674,230777,230908,230973,231018,231111,231217,231302,231383,231455,231585,231649,231727,231786,231868,231967,232046,232154,232241,232296,232351,232408,232465,232549,232653,232686,232720,232853,232904,232964,233039,233081,233205,233278,233348,233396,233466,233562,233629,233681,233756,233814,233871,233901,233959,234068,234119,234200,234260,234301,234356,234389,234457,234473,234545,234599,234651,234715,234788,234872,234934,234972,235026,235074,235170,235203,235241,235311,235362,235417,235469,235512,235553,235587,235614,235636,235699,235737,235797,235836,235870,235926,236013,236065,236091,236126,236177,236207,236232,236280,236355,236420,236455,236522,236556,236599,236641,236677,236706,236745,236791,236808,236843,236868,236891,236916,236986,237017,237053,237111,237157,237173,237188,237218,237279,237358,237418,237452,237471,237487,237520,237579,237628,237658,237680,237706,237758,237803,237839,237870,237892,237927,237941,237967,237971,238001,238014,238049,238083,238108,238124,238184,238205,238250,238275,238285,238294,238322,238359,238408,238465,238514,238571,238579,238610,238632,238655,238677,238720,238755,238772,238785,238835,238864,238872,238901,238915,238933,238948,238978,239011,239043,239064,239092,239122,239155,239168,239179,239241,239278,239283,239337,239375,239398,239441,239450,239476,239504,239541,239559,239565,239634,239650,239667,239727,239754,239766,239801,239871,239894,239928,239936,239962,240012,240045,240067,240085,240103,240134,240165,240187,240199,240227,240242,240251,240265,240281,240305,240329,240362,240387,240404,240419,240424,240435,240452,240472,240487,240501,240508,240532,240532,240594,240610,240657,240659,240688,240696,240708,240730,240744,240777,240792,240801,240813,240828,240837,240852,240853,240853,240893,240951,240957,240998,241007,241008,241024,241044,241095,241095,241111,241152,241170,241184,241213,241226,241250,241292,241320,241345,241345,241369,241394,241442,241461,241476,241476,241479,241495,241511,241520,241539,241545,241559,241581,241599,241634,241639,241662,241667,241685,241694,241695,241709,241724,241742,241750,241756,241787,241795,241802,241810,241819,241822,241831,241856,241889,241901,241904,241930,241934,241949,241960,241969,241979,241997,242015,242043,242058,242058,242061,242095,242109,242133,242140,242168,242176,242192,242201,242205,242222,242222,242234,242238,242248,242270,242289,242315,242324,242341,242381,242401,242411,242420,242437,242455,242460,242484,242498,242521,242523,242532,242551,242553,242586,242601,242629,242652,242677,242678,242687,242718,242731,242734,242762,242762,242790,242841,242841,242855,242879,242887,242906,242918,242922,242943,242966,243000,243000,243012,243040,243040,243045,243055,243076,243089,243122,243137,243153,243159,243166,243173,243183,243186,243230,243253,243274,243285,243308,243326,243336,243339,243352,243355,243365,243394,243394,243397,243406,243411,243417,243422,243429,243438,243438,243443,243449,243450,243464,243477,243481,243495,243497,243517,]
hll_evol_skipped = [31222,204203,223569,231111,235203,237706,239450,240828,241831,242762,243517]
hll_sparse = [204521,223843,231532,235761,238214,239903,241075,241879,242689,243297]
hll_nosparse = [204359,223962,231494,235772,238426,239941,241352,242283,243130,243872]

fig, ax = plt.subplots(1,1, figsize=(10,5))

# ax.plot(list(range(len(hll_evol))), hll_evol, '-', linewidth=0.8, label='hll 10min')
ax.plot(list(range(len(hll_evol_skipped))), hll_evol_skipped, '-', linewidth=0.8, label='hll_evol_skipped')
ax.plot(list(range(len(hll_sparse))), hll_sparse, '-', linewidth=0.8, label='hll_sparse')
ax.plot(list(range(len(hll_nosparse))), hll_nosparse, '-', linewidth=0.8, label='hll_nosparse')

ax.axhline(y=(real), color='r', linestyle='--', linewidth=0.5, alpha=0.5, label=f"real {real}")

ax.set_xlabel('time (s)')
ax.set_ylabel('Estimated cardinality')
ax.set_title(title)
ax.legend()

plt.tight_layout()
plt.show()

# 2024/01/28 22:30:51 final estimate: 243519
# 2024/01/28 22:30:51 terminals: 19596996
# 2024/01/28 22:30:51 finished: 10m0.002625583s
# err. rel. = ((248732 - 243519) / 248732) * 100 = 2,1%
# 19596996 / 2446543800 = 0,008010073639 ~ 0,8%
# 
